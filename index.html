<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CTF AI System</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            max-width: 900px; 
            margin: 0 auto; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            min-height: 100vh; 
        }
        .container { 
            background: white; 
            padding: 40px; 
            border-radius: 15px; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.2); 
        }
        h1 { 
            color: #333; 
            text-align: center; 
            margin-bottom: 10px; 
            font-size: 2.5em; 
        }
        .subtitle { 
            text-align: center; 
            color: #666; 
            margin-bottom: 30px; 
        }
        .status-bar { 
            background: #e8f5e8; 
            border: 1px solid #4caf50; 
            border-radius: 8px; 
            padding: 15px; 
            margin-bottom: 25px; 
        }
        .chat { 
            border: 1px solid #ddd; 
            height: 450px; 
            overflow-y: auto; 
            padding: 20px; 
            margin: 25px 0; 
            background: #fafafa; 
            border-radius: 10px; 
        }
        .input-area { 
            display: flex; 
            gap: 12px; 
        }
        input { 
            flex: 1; 
            padding: 15px; 
            border: 1px solid #ddd; 
            border-radius: 8px; 
            font-size: 16px; 
        }
        button { 
            padding: 15px 30px; 
            background: #4299e1; 
            color: white; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 16px; 
            font-weight: bold; 
        }
        button:hover { 
            background: #3182ce; 
        }
        .message { 
            margin: 15px 0; 
            padding: 15px; 
            border-radius: 10px; 
        }
        .user { 
            background: #e3f2fd; 
            border-left: 4px solid #2196f3; 
        }
        .ai { 
            background: #f3e5f5; 
            border-left: 4px solid #9c27b0; 
        }
        .loading { 
            background: #fff3cd; 
            border-left: 4px solid #ffc107; 
            font-style: italic; 
        }
        .confidence { 
            font-size: 0.9em; 
            color: #666; 
            margin-top: 8px; 
            font-weight: bold; 
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ”’ PentestGPT System</h1>
        <p class="subtitle">Advanced AI-powered penetration testing assistant for cybersecurity professionals</p>
        
        <div class="status-bar">
            <strong>Status:</strong> <span id="status">Initializing...</span> | 
            <strong>AI Model:</strong> Phi-3-Mini (Client-side) | 
            <strong>Mode:</strong> <span id="mode">Free & Private</span>
        </div>
        
        <div class="chat" id="chat">
            <div class="message ai">
                <strong>PentestGPT:</strong> Greetings! I'm your advanced AI penetration testing assistant. I can help you with:
                <br>â€¢ Web application security testing (OWASP Top 10, API testing)
                <br>â€¢ Network penetration testing (reconnaissance, enumeration, exploitation)
                <br>â€¢ Binary exploitation & reverse engineering (pwn, malware analysis)
                <br>â€¢ Cryptographic analysis & attack methodologies
                <br>â€¢ Digital forensics & incident response
                <br>â€¢ OSINT & social engineering assessments
                <br><br>What security assessment are you conducting? Provide target details for tailored guidance.
            </div>
        </div>
        
        <div class="input-area">
            <input type="text" id="question" placeholder="Describe your penetration test scenario, target, or security question..." onkeypress="if(event.key==='Enter') ask()">
            <button onclick="ask()">Ask AI</button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@mlc-ai/web-llm@0.2.46/lib/index.min.js"></script>
    <script>
        let engine = null;
        let isModelLoaded = false;
        
        // Initialize WebLLM on page load
        async function initializeAI() {
            try {
                const statusEl = document.getElementById('status');
                statusEl.textContent = 'Loading AI model...';
                
                // Use Phi-3 Mini - better performance and CTF knowledge
                const selectedModel = "Phi-3-mini-4k-instruct-q4f16_1";
                
                engine = new webllm.MLCEngine();
                
                // Set up progress callback
                engine.setInitProgressCallback((progress) => {
                    statusEl.textContent = `Loading model: ${Math.round(progress.progress * 100)}%`;
                });
                
                await engine.reload(selectedModel);
                isModelLoaded = true;
                statusEl.textContent = 'AI Ready';
                
                console.log('CTF AI model loaded successfully');
            } catch (error) {
                console.error('Failed to load AI model:', error);
                document.getElementById('status').textContent = 'AI Error - Using fallback';
                // Fall back to server-side responses
            }
        }
        
        // Generate AI response using WebLLM
        async function generateAIResponse(question) {
            if (!isModelLoaded || !engine) {
                throw new Error('AI model not loaded');
            }
            
            const ctfPrompt = `You are PentestGPT - an advanced AI penetration testing assistant specializing in CTF challenges. Analyze this cybersecurity scenario:

CHALLENGE: ${question}

ANALYSIS FRAMEWORK:
1. RECONNAISSANCE: Identify attack surface and entry points
2. VULNERABILITY ASSESSMENT: Categorize potential security weaknesses
3. EXPLOITATION: Provide step-by-step attack methodology
4. POST-EXPLOITATION: Suggest privilege escalation or data extraction

SPECIALIZATION AREAS:
â€¢ WEB APPLICATION SECURITY: SQL injection, XSS, CSRF, SSRF, authentication bypass, directory traversal, LFI/RFI, XXE
â€¢ BINARY EXPLOITATION: Buffer/heap overflows, format strings, ROP/JOP chains, shellcode development, ASLR/DEP bypass
â€¢ CRYPTANALYSIS: RSA factorization, padding oracles, weak random numbers, hash collisions, cipher breaking, side-channel attacks
â€¢ NETWORK SECURITY: Port scanning, service enumeration, protocol exploitation, man-in-the-middle attacks
â€¢ REVERSE ENGINEERING: Static/dynamic analysis, unpacking, anti-debugging bypass, malware analysis, firmware extraction
â€¢ DIGITAL FORENSICS: File carving, metadata analysis, steganography, memory forensics, timeline reconstruction
â€¢ OSINT: Information gathering, social engineering, public records analysis

METHODOLOGY:
1. Threat modeling and attack vector identification
2. Tool selection (nmap, Burp Suite, Metasploit, Ghidra, Wireshark, etc.)
3. Exploit development with code examples
4. Defensive recommendations

Provide technical depth appropriate for cybersecurity professionals. Include specific commands, payloads, and exploit code when relevant.`;

            const messages = [
                { role: "system", content: "You are an expert CTF (Capture The Flag) cybersecurity assistant." },
                { role: "user", content: ctfPrompt }
            ];
            
            const reply = await engine.chat.completions.create({
                messages: messages,
                temperature: 0.7,
                max_tokens: 500,
            });
            
            return reply.choices[0].message.content;
        }
        
        // Fallback to server when AI fails
        async function fallbackResponse(question) {
            const response = await fetch('/api/ask', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ question: question })
            });
            const data = await response.json();
            return data.answer;
        }
        
        async function ask() {
            const input = document.getElementById('question');
            const question = input.value.trim();
            if (!question) return;
            
            addMessage('user', question);
            input.value = '';
            
            const loadingMsg = addMessage('loading', 'AI is thinking...');
            
            try {
                let answer;
                let confidence = 0;
                let category = 'ai-generated';
                
                if (isModelLoaded && engine) {
                    // Use client-side AI
                    answer = await generateAIResponse(question);
                    confidence = 95; // High confidence for AI responses
                    loadingMsg.querySelector('strong').textContent = 'CTF AI';
                    loadingMsg.innerHTML = loadingMsg.innerHTML.replace('AI is thinking...', 'Generating response...');
                } else {
                    // Fall back to server
                    answer = await fallbackResponse(question);
                    confidence = 75;
                }
                
                loadingMsg.remove();
                const response = addMessage('ai', answer);
                
                const conf = document.createElement('div');
                conf.className = 'confidence';
                conf.textContent = `Confidence: ${confidence}% | Source: ${isModelLoaded ? 'Client AI' : 'Knowledge Base'}`;
                response.appendChild(conf);
                
            } catch (error) {
                console.error('Error generating response:', error);
                loadingMsg.remove();
                addMessage('ai', 'Sorry, I encountered an error. Please try again or check your connection.');
            }
        }
        
        function addMessage(type, text) {
            const chat = document.getElementById('chat');
            const div = document.createElement('div');
            div.className = 'message ' + (type === 'loading' ? 'loading' : type);
            div.innerHTML = '<strong>' + (type === 'user' ? 'You' : type === 'loading' ? 'Processing' : 'PentestGPT') + ':</strong> ' + text.replace(/\n/g, '<br>');
            chat.appendChild(div);
            chat.scrollTop = chat.scrollHeight;
            return div;
        }
        
        // Initialize AI when page loads
        window.addEventListener('load', initializeAI);
    </script>
</body>
</html>